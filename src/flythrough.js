
var recordPositions = function( camera, intervallTime, maxTime ) {

	console.log("Recording states");

	var addPosition = function( states, posIndex ) {
		
		var time = new Date().getTime() - startTime;

		states.push({ 
			timestamp : time,
			position : camera.position.clone(),
			rotation : camera.rotation.clone()
		});

		if ( time >= maxTime ) {
			clearInterval( recorder )
			savePositions( "dummyPath", states );
		}
	}

	var startTime = new Date().getTime();
	
	var states = []; // format: {timestamp, position, rotations}  position: new THREE.Vector3(x,y,z) rotations: new THREE.Eulur (_x, _y,_z...)
	var counter = 0;

	var	recorder = setInterval( function() {
		addPosition( states, counter );
		counter = counter + 1;

	}, intervallTime);
	

}

// The function only prints out the result in the console
var savePositions = function( dummyPath, states ) {

	// temp solution. stringify converts  position to {x:xValue, y:Value, zValue} instead of new THREE.Vector3(...)
	var statesString = JSON.stringify(states);
	console.log(statesString);

	// save to file. hopefullt find a descent solution later
	// ...
}


// controller is needed since it might block the rotations. it will be "disabled" in the beginning and "activiated" in the end
var flyThroughPositionsFromFile = function( path, camera, controller, useRotations ) {

	$.get( path, function( jsonTextFile ){ 
		var states = JSON.parse(jsonTextFile);
		flyThroughPositions( camera, states, useRotations ); 
	});

}

var flyThroughPositions = function( camera, states, controller, useRotations ) {


	// recursive function
	var setStates = function( states, i ) {
		var waitTime = states[i].timestamp - states[ i-1 ].timestamp;
		setTimeout( function() {
			var pos = states[i].position;
			camera.position = new THREE.Vector3( pos.x, pos.y, pos.z ); 
			
			if ( useRotations ) {
				var rot = states[i].rotation;
				camera.rotation.x = rot._x;
				camera.rotation.y = rot._y;
				camera.rotation.z = rot._z;			
			}

			if ( states.length > (i + 1) ) {
				setStates( states,  i + 1);
			}
			else {
				controller.update = controllerUpdateCopy;			
			}

		}, waitTime );
	}

	// removes the effect of update in the controller, so that the controller don't undos the rotations
	var controllerUpdateCopy = controller.update;
	controller.update = function() {};

	var pos = states[0].position;
	setStates( states, 1 );

}

var hardCodedString = '[{"timestamp":107,"position":{"x":0,"y":0,"z":12},"rotation":{"_x":1.5707963267948966,"_y":0,"_z":0,"_order":"XYZ"}},{"timestamp":211,"position":{"x":0,"y":0,"z":12},"rotation":{"_x":1.5707963267948966,"_y":0,"_z":0,"_order":"XYZ"}},{"timestamp":264,"position":{"x":0,"y":0,"z":12},"rotation":{"_x":1.5707963267948966,"_y":0,"_z":0,"_order":"XYZ"}},{"timestamp":315,"position":{"x":0,"y":0,"z":12},"rotation":{"_x":1.5707963267948966,"_y":0,"_z":0,"_order":"XYZ"}},{"timestamp":452,"position":{"x":0,"y":0,"z":12},"rotation":{"_x":1.5707963267948966,"_y":0,"_z":0,"_order":"XYZ"}},{"timestamp":545,"position":{"x":0,"y":0,"z":12},"rotation":{"_x":1.5707963267948966,"_y":0,"_z":0,"_order":"XYZ"}},{"timestamp":623,"position":{"x":0,"y":0,"z":12},"rotation":{"_x":1.5707963267948966,"_y":0,"_z":0,"_order":"XYZ"}},{"timestamp":752,"position":{"x":0,"y":0,"z":12},"rotation":{"_x":1.5707963267948966,"_y":0,"_z":0,"_order":"XYZ"}},{"timestamp":874,"position":{"x":0,"y":0,"z":12},"rotation":{"_x":1.5707963267948966,"_y":0,"_z":0,"_order":"XYZ"}},{"timestamp":1121,"position":{"x":0,"y":0,"z":12},"rotation":{"_x":1.5707963267948966,"_y":0,"_z":0,"_order":"XYZ"}},{"timestamp":1175,"position":{"x":0,"y":0,"z":12},"rotation":{"_x":1.5707963267948966,"_y":0,"_z":0,"_order":"XYZ"}},{"timestamp":1233,"position":{"x":0,"y":0,"z":12},"rotation":{"_x":1.566930568866089,"_y":0.014159431380203634,"_z":0.00002334559502999315,"_order":"XYZ"}},{"timestamp":1289,"position":{"x":0,"y":0,"z":12},"rotation":{"_x":1.5643240442849033,"_y":0.030770940094214657,"_z":0.00008142099449618608,"_order":"XYZ"}},{"timestamp":1344,"position":{"x":0,"y":0,"z":12},"rotation":{"_x":1.5627242283886362,"_y":0.048212972972663054,"_z":0.0001433612193295625,"_order":"XYZ"}},{"timestamp":1397,"position":{"x":0,"y":0,"z":12},"rotation":{"_x":1.5623832600100143,"_y":0.07607692605626956,"_z":0.0001574475794829032,"_order":"XYZ"}},{"timestamp":1456,"position":{"x":0,"y":0,"z":12},"rotation":{"_x":1.5633925596210299,"_y":0.10473206274745732,"_z":0.00006473838298985129,"_order":"XYZ"}},{"timestamp":1526,"position":{"x":0,"y":0,"z":12},"rotation":{"_x":1.5646623486412565,"_y":0.13386168530290693,"_z":-0.00008631737764006582,"_order":"XYZ"}},{"timestamp":1577,"position":{"x":0,"y":0,"z":12},"rotation":{"_x":1.5655144332694018,"_y":0.1539536805649403,"_z":-0.0002085139677481187,"_order":"XYZ"}},{"timestamp":1634,"position":{"x":0,"y":0,"z":12},"rotation":{"_x":1.5668881496340779,"_y":0.18383434460126355,"_z":-0.00044042968021293144,"_order":"XYZ"}},{"timestamp":1689,"position":{"x":-0.28824585745479003,"y":1.4719898874159838,"z":11.995051759466113},"rotation":{"_x":1.5688774520647333,"_y":0.21177622133442398,"_z":-0.0008349596945213632,"_order":"XYZ"}},{"timestamp":1741,"position":{"x":-0.4984426269224139,"y":2.4496471886793874,"z":11.993175755273425},"rotation":{"_x":1.5688774520647333,"_y":0.21177622133442398,"_z":-0.0008349596945213632,"_order":"XYZ"}},{"timestamp":1804,"position":{"x":-0.8137377811238498,"y":3.9161331405744924,"z":11.990361748984393},"rotation":{"_x":1.5688774520647333,"_y":0.21177622133442398,"_z":-0.0008349596945213632,"_order":"XYZ"}},{"timestamp":1865,"position":{"x":-1.1290329353252855,"y":5.3826190924695965,"z":11.98754774269536},"rotation":{"_x":1.5688774520647333,"_y":0.21177622133442398,"_z":-0.0008349596945213632,"_order":"XYZ"}},{"timestamp":1931,"position":{"x":-1.5494264742605328,"y":7.337933694996401,"z":11.983795734309984},"rotation":{"_x":1.5688774520647333,"_y":0.21177622133442398,"_z":-0.0008349596945213632,"_order":"XYZ"}},{"timestamp":2004,"position":{"x":-1.8647216284619683,"y":8.804419646891505,"z":11.980981728020952},"rotation":{"_x":1.5688774520647333,"_y":0.21177622133442398,"_z":-0.0008349596945213632,"_order":"XYZ"}},{"timestamp":2068,"position":{"x":-2.1892007552499573,"y":10.268859030262341,"z":11.973473746277158},"rotation":{"_x":1.5591395507724288,"_y":0.23109510033863545,"_z":0.0013028039991988703,"_order":"XYZ"}},{"timestamp":2127,"position":{"x":-2.54378044950673,"y":11.726150890652852,"z":11.95176486853766},"rotation":{"_x":1.5500768800003142,"_y":0.2549832060987577,"_z":0.0034749799172351463,"_order":"XYZ"}},{"timestamp":2178,"position":{"x":-2.935450740919375,"y":13.173681931660482,"z":11.918400681397191},"rotation":{"_x":1.543413567286226,"_y":0.28285912484111236,"_z":0.005241834273112079,"_order":"XYZ"}},{"timestamp":2244,"position":{"x":-3.3680995991076355,"y":14.609270154688424,"z":11.876524061391084},"rotation":{"_x":1.5381303348523383,"_y":0.31231492577875103,"_z":0.006789912507623243,"_order":"XYZ"}},{"timestamp":2310,"position":{"x":-3.8430805248037183,"y":16.031186044943226,"z":11.827562243928787},"rotation":{"_x":1.5328326754998314,"_y":0.34200041926122615,"_z":0.00849252108224886,"_order":"XYZ"}},{"timestamp":2366,"position":{"x":-4.3600771827315175,"y":17.438108868973412,"z":11.771601889946488},"rotation":{"_x":1.5274218363497036,"_y":0.371676856128045,"_z":0.010382813838960385,"_order":"XYZ"}},{"timestamp":2424,"position":{"x":-4.918621006133055,"y":18.82876349809823,"z":11.708693717686248},"rotation":{"_x":1.5218843353615785,"_y":0.4013431542693204,"_z":0.012470454360366331,"_order":"XYZ"}},{"timestamp":2493,"position":{"x":-5.518208942492928,"y":20.201901279590654,"z":11.63914653964635},"rotation":{"_x":1.5177777180016965,"_y":0.4310187696827876,"_z":0.014121663715746198,"_order":"XYZ"}},{"timestamp":2549,"position":{"x":-5.940498199295895,"y":21.107082563337013,"z":11.591250371522104},"rotation":{"_x":1.519526418453584,"_y":0.45046210466766323,"_z":0.013370537802326903,"_order":"XYZ"}},{"timestamp":2613,"position":{"x":-6.605237006003812,"y":22.450098540933965,"z":11.52556752803825},"rotation":{"_x":1.528418094773205,"_y":0.4749774424009559,"_z":0.009385394032976863,"_order":"XYZ"}},{"timestamp":2664,"position":{"x":-7.301007798963332,"y":23.777955173164457,"z":11.474582812780621},"rotation":{"_x":1.5405142861273222,"_y":0.4970588043926694,"_z":0.003734758037258579,"_order":"XYZ"}},{"timestamp":2727,"position":{"x":-8.02592228289443,"y":25.09066858714093,"z":11.440200302152801},"rotation":{"_x":1.5529999747224585,"_y":0.5189980567858875,"_z":-0.0023403034949508778,"_order":"XYZ"}},{"timestamp":2781,"position":{"x":-8.779220257103285,"y":26.387638130760244,"z":11.422394418891043},"rotation":{"_x":1.5646190906761126,"_y":0.5401651394005441,"_z":-0.008207091204378358,"_order":"XYZ"}},{"timestamp":2848,"position":{"x":-9.559300530552658,"y":27.668802172163602,"z":11.41851316905185},"rotation":{"_x":1.5734364590630983,"_y":0.5597642708332633,"_z":-0.012813579415444752,"_order":"XYZ"}},{"timestamp":2915,"position":{"x":-10.363351565547937,"y":28.93505574922447,"z":11.425122611280775},"rotation":{"_x":1.5812302976638042,"_y":0.5774864141975554,"_z":-0.017010955852468757,"_order":"XYZ"}},{"timestamp":2969,"position":{"x":-11.189539874133894,"y":30.186889113171006,"z":11.44148544934712},"rotation":{"_x":1.5892009907622369,"_y":0.5949824135920236,"_z":-0.02142075224231083,"_order":"XYZ"}},{"timestamp":3020,"position":{"x":-12.0374923625629,"y":31.42391640174517,"z":11.467594824929646},"rotation":{"_x":1.597163501759811,"_y":0.6126502752239263,"_z":-0.025940561348292725,"_order":"XYZ"}},{"timestamp":3072,"position":{"x":-12.907780020495037,"y":32.64510338768671,"z":11.502738660381997},"rotation":{"_x":1.6037617113929825,"_y":0.6330164563356081,"_z":-0.02978353827502416,"_order":"XYZ"}},{"timestamp":3125,"position":{"x":-13.805072968083715,"y":33.846362346226776,"z":11.544404058009155},"rotation":{"_x":1.6087528917475948,"_y":0.6583160443059155,"_z":-0.03278512142808544,"_order":"XYZ"}},{"timestamp":3180,"position":{"x":-14.732995255372945,"y":35.02393080629363,"z":11.591063902115437},"rotation":{"_x":1.613761445438006,"_y":0.6843601205538605,"_z":-0.03590088152428198,"_order":"XYZ"}},{"timestamp":3241,"position":{"x":-15.691317546057135,"y":36.176686221684925,"z":11.642607010628218},"rotation":{"_x":1.6186694499600294,"_y":0.7106778882920821,"_z":-0.03905125037162453,"_order":"XYZ"}},{"timestamp":3311,"position":{"x":-16.6802601034056,"y":37.303112862125055,"z":11.697620377633038},"rotation":{"_x":1.6204038495463755,"_y":0.739185209925959,"_z":-0.04019339311929167,"_order":"XYZ"}},{"timestamp":3367,"position":{"x":-17.70218657207634,"y":38.399740424003596,"z":11.751555281789752},"rotation":{"_x":1.6178782336685922,"_y":0.7715366625239044,"_z":-0.03845396491365588,"_order":"XYZ"}},{"timestamp":3422,"position":{"x":-18.760953970791366,"y":39.46109764626282,"z":11.799569863111445},"rotation":{"_x":1.6115479335707785,"_y":0.8087226183272725,"_z":-0.03395220487193925,"_order":"XYZ"}},{"timestamp":3473,"position":{"x":-19.859586994001102,"y":40.48149472638799,"z":11.83865207398327},"rotation":{"_x":1.603820545088887,"_y":0.8489502593766803,"_z":-0.028254991859404884,"_order":"XYZ"}},{"timestamp":3537,"position":{"x":-20.614788494644987,"y":41.13662306561389,"z":11.859316615292801},"rotation":{"_x":1.5943921051615892,"_y":0.8923231092968441,"_z":-0.021043548419295437,"_order":"XYZ"}},{"timestamp":3608,"position":{"x":-20.614788494644987,"y":41.13662306561389,"z":11.859316615292801},"rotation":{"_x":1.5815507109281555,"_y":0.9393027626354593,"_z":-0.010856123524399248,"_order":"XYZ"}},{"timestamp":3661,"position":{"x":-20.614788494644987,"y":41.13662306561389,"z":11.859316615292801},"rotation":{"_x":1.5714479017031429,"_y":0.9720121016255375,"_z":-0.0026033853145275756,"_order":"XYZ"}},{"timestamp":3717,"position":{"x":-20.614788494644987,"y":41.13662306561389,"z":11.859316615292801},"rotation":{"_x":1.5599989958666836,"_y":1.0058939756440541,"_z":0.006962404574004355,"_order":"XYZ"}},{"timestamp":3778,"position":{"x":-20.614788494644987,"y":41.13662306561389,"z":11.859316615292801},"rotation":{"_x":1.5401954867194343,"_y":1.0591984404181085,"_z":0.02397005564140457,"_order":"XYZ"}},{"timestamp":3836,"position":{"x":-20.614788494644987,"y":41.13662306561389,"z":11.859316615292801},"rotation":{"_x":1.5166064522501528,"_y":1.114326623303496,"_z":0.04485349841700733,"_order":"XYZ"}},{"timestamp":3901,"position":{"x":-20.614788494644987,"y":41.13662306561389,"z":11.859316615292801},"rotation":{"_x":1.4886351225846781,"_y":1.1700156558405943,"_z":0.0702978882253631,"_order":"XYZ"}},{"timestamp":3965,"position":{"x":-22.006451396578907,"y":41.693516444213266,"z":11.808307395804116},"rotation":{"_x":1.459987617958213,"_y":1.226080747188018,"_z":0.09697769392526026,"_order":"XYZ"}},{"timestamp":4021,"position":{"x":-23.427261923874887,"y":42.170492318271656,"z":11.75121943653197},"rotation":{"_x":1.4355987767992233,"_y":1.281850386794764,"_z":0.12014300346464457,"_order":"XYZ"}},{"timestamp":4072,"position":{"x":-24.872457654257047,"y":42.56763028757285,"z":11.694726093347922},"rotation":{"_x":1.4176140891618296,"_y":1.3361059319907438,"_z":0.1375087053378533,"_order":"XYZ"}},{"timestamp":4135,"position":{"x":-26.337117031466917,"y":42.88659975668631,"z":11.644088333916166},"rotation":{"_x":1.4055813877426453,"_y":1.3886355329709792,"_z":0.149275395701933,"_order":"XYZ"}},{"timestamp":4196,"position":{"x":-27.816611476675988,"y":43.1293839668646,"z":11.60277201660316},"rotation":{"_x":1.3929172890324202,"_y":1.4402714680141748,"_z":0.16178920899829044,"_order":"XYZ"}},{"timestamp":4251,"position":{"x":-29.306914743914533,"y":43.29537301180421,"z":11.571645131635561},"rotation":{"_x":1.3553875520731948,"_y":1.4951578315264258,"_z":0.19913766483897596,"_order":"XYZ"}},{"timestamp":4302,"position":{"x":-30.804569612214564,"y":43.37134185328459,"z":11.551123913566633},"rotation":{"_x":0.043352992928886815,"_y":1.5620432610920956,"_z":1.5108621946216099,"_order":"XYZ"}},{"timestamp":4369,"position":{"x":-32.303593907411084,"y":43.33042616022453,"z":11.541727234113315},"rotation":{"_x":-1.5556602003075528,"_y":1.4867029598273678,"_z":3.109510228960221,"_order":"XYZ"}},{"timestamp":4420,"position":{"x":-33.7934811806201,"y":43.16041123088856,"z":11.543598695425224},"rotation":{"_x":-1.607262607019632,"_y":1.3973538366539289,"_z":-3.1224473422152608,"_order":"XYZ"}},{"timestamp":4480,"position":{"x":-35.74482985927382,"y":42.72758415144651,"z":11.56321031978534},"rotation":{"_x":-1.6248298861740946,"_y":1.2771995197659596,"_z":-3.105325964232865,"_order":"XYZ"}},{"timestamp":4531,"position":{"x":-37.630162296405054,"y":42.06459652686744,"z":11.60134918903734},"rotation":{"_x":-1.6323695037426733,"_y":1.1570085101609928,"_z":-3.0982402523023356,"_order":"XYZ"}},{"timestamp":4582,"position":{"x":-38.984419941833224,"y":41.42194879123689,"z":11.641790515336025},"rotation":{"_x":-1.6357620132938542,"_y":1.0668569771097032,"_z":-3.095195582892901,"_order":"XYZ"}},{"timestamp":4633,"position":{"x":-40.275205347249624,"y":40.66037452256369,"z":11.692020522736312},"rotation":{"_x":-1.6381988857300593,"_y":0.9767019482936944,"_z":-3.0931147240913983,"_order":"XYZ"}},{"timestamp":4684,"position":{"x":-41.492032132585855,"y":39.786060773473395,"z":11.751631141123505},"rotation":{"_x":-1.6400605002019206,"_y":0.8865448152247151,"_z":-3.0916190925400318,"_order":"XYZ"}},{"timestamp":4735,"position":{"x":-42.62501764199761,"y":38.80610773425747,"z":11.820054172235906},"rotation":{"_x":-1.6405909515730097,"_y":0.7964204091418454,"_z":-3.0912080328671534,"_order":"XYZ"}},{"timestamp":4786,"position":{"x":-43.3292261085974,"y":38.097977897290626,"z":11.869221678968767},"rotation":{"_x":-1.6355197703844784,"_y":0.7065007875038652,"_z":-3.0946408732354445,"_order":"XYZ"}},{"timestamp":4839,"position":{"x":-43.3292261085974,"y":38.097977897290626,"z":11.869221678968767},"rotation":{"_x":-1.6253125336742296,"_y":0.6167734208279086,"_z":-3.1008959408525545,"_order":"XYZ"}},{"timestamp":4903,"position":{"x":-43.3292261085974,"y":38.097977897290626,"z":11.869221678968767},"rotation":{"_x":-1.609859366698674,"_y":0.4971800635083849,"_z":-3.1090619025956494,"_order":"XYZ"}},{"timestamp":4954,"position":{"x":-43.3292261085974,"y":38.097977897290626,"z":11.869221678968767},"rotation":{"_x":-1.5989108926331395,"_y":0.40744195234449687,"_z":-3.1138492184974944,"_order":"XYZ"}},{"timestamp":5012,"position":{"x":-43.3292261085974,"y":38.097977897290626,"z":11.869221678968767},"rotation":{"_x":-1.585310989813785,"_y":0.28773560700703477,"_z":-3.1184901510300334,"_order":"XYZ"}}]';
var hardCodedRecording = JSON.parse( hardCodedString );